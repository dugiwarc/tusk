<% include ../partials/header %>
		<div class="search_bar">
            <form action="/users" method="get" class="">
                <input type="text" name="search" placeholder="User search...">
                <input type="submit" value="search" class="button">
            </form>
            <h1>My messages</h1>
    </div>

<% var lst = [] %>

<% allusers.forEach(function(each_user){ %>
  <% message.forEach(function(each_message){ %>
    <% if(currentUser._id.equals(each_message.receiver.id) && each_user.equals(each_message.sender.id)){ %>
      <% message.forEach(function(final_message){ %>

        <% if(final_message.sender.equals(each_message.sender)){%>
            <% lst.push(each_message.sender) %>
        <% } %>
      <% }); %>
    <% } %>
  <% }) %>
<% }) %>

<% function onlyUnique(value, index, self) {  %>
<%    return self.indexOf(value) === index; %>
<% } %>

<% function removeDuplicates(originalArray, prop) { %>
<%      var newArray = []; %>
<%      var lookupObject  = {}; %>
<% %>
<%     for(var i in originalArray) { %>
<%        lookupObject[originalArray[i][prop]] = originalArray[i]; %>
<%     } %>
<% %>
<%     for(i in lookupObject) { %>
<%         newArray.push(lookupObject[i]); %>
<%     } %>
<%      return newArray; %>
<% } %>

<% var a = removeDuplicates(lst, "id"); %>

<div class="m_window">
<div class="m_contacts">
<% a.forEach(function(hombre){ %>
  <ul class="message">Messages received from <%= hombre.username %>
    <% message.forEach(function(message){ %>
        <% if((message.sender.id.equals(hombre.id) && message.receiver.id.equals(currentUser._id)) || (message.sender.id.equals(currentUser._id) && message.receiver.id.equals(hombre.id))){ %>
          <li><%= message.text %></li>
        <% } %>
        <% }); %>
        <li>        <form action="/users/<%= hombre.id %>/messages" method="post">
        <input type="text" name="message[text]"  placeholder="text">
        <button>Submit</button>
      </form></li>
        </ul>

<% }); %>
</div>
<div class="m_chat">
  <ul class="list2">
  </ul>
</div>
</div>

<script>
  // function fn_click()
  // {
  //   this.classList.add('hide_yo');
  //   console.log("ge");
  //   setTimeout(()=>{
  //     console.log(this);
  //     this.classList.add('hide_yo');
  //   }, 1000);
  // }

  // const messages = document.querySelectorAll('.message > li');

  // messages.forEach(trigger => trigger.addEventListener('click', fn_click));

<body onload="myFunction()">
  $('body').on('click', '.message', function() {
    $('.list2').empty();
    $(this).addClass('selected');
    // $('.list2').append($('.selected > li'));
    $(".selected > li")
      .clone()
      .appendTo(".list2");
    // $('.selected').append($('.list2 > li'));
    // setTimeout(()=>{ $('.selected').append($('.list2 > li')); $(this).removeClass('selected'); }, 1000);
    $(this).removeClass('selected');
});
</script>




<% include ../partials/footer %>
